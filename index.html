<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Support Archbishop Bagrat Galstanyan and Archbishop Mikael Adjapahyan</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h1 {
      color: #8B0000;
      text-align: center;
    }
    form {
      margin-bottom: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #8B0000;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    #letterPreview {
      background: #fff;
      padding: 20px;
      border-left: 4px solid #8B0000;
      white-space: pre-wrap;
    }
    .hidden {
      display: none;
    }
    #repsList {
      margin-top: 10px;
      font-size: 0.9em;
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      max-height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

  <h1>Support Archbishop Bagrat Galstanyan and Archbishop Mikael Adjapahyan</h1>
  <p style="text-align:center; font-weight: bold; margin-top: -10px;">
    Demand their immediate release from unlawful detention by the Armenian government.
  </p>

  <form id="letterForm">
    <input type="text" id="fullName" placeholder="Full Name" required />
    <input type="text" id="email" placeholder="Email Address" required />
    <input type="text" id="phone" placeholder="Phone Number (optional)" />
    <input type="text" id="address" placeholder="Street Address" required />
    <input type="text" id="city" placeholder="City" required />
    <input type="text" id="state" placeholder="State" required />
    <input type="text" id="zip" placeholder="ZIP Code" required />
    <button type="button" id="lookupReps">Lookup Representatives</button>
    <div id="repsList" class="hidden"></div>
    <button type="submit">Generate Letter</button>
  </form>

  <div id="letterContainer" class="hidden">
    <h2>Your Letter:</h2>
    <div id="letterPreview"></div>
    <button onclick="copyLetter()">ðŸ“‹ Copy Letter</button>
    <button id="sendEmailButton">ðŸ“§ Send via Email</button>
  </div>

  <script>
    const apiKey = AIzaSyAqtipxKMT5VyD8-o-GJWkeqg761iVvm90

    const form = document.getElementById('letterForm');
    const letterContainer = document.getElementById('letterContainer');
    const letterPreview = document.getElementById('letterPreview');
    const sendEmailButton = document.getElementById('sendEmailButton');
    const lookupButton = document.getElementById('lookupReps');
    const repsList = document.getElementById('repsList');

    let representatives = [];

    lookupButton.addEventListener('click', () => {
      const zip = document.getElementById('zip').value.trim();
      if (!zip.match(/^\d{5}$/)) {
        alert('Please enter a valid 5-digit ZIP code');
        return;
      }
      repsList.textContent = 'Looking up representatives...';
      repsList.classList.remove('hidden');

      fetch(`https://www.googleapis.com/civicinfo/v2/representatives?key=${apiKey}&address=${zip}`)
        .then(res => res.json())
        .then(data => {
          representatives = [];
          const offices = data.offices || [];
          const officials = data.officials || [];
          const repNames = [];

          offices.forEach(office => {
            if (
              office.name.includes('United States Senate') ||
              office.name.includes('United States House of Representatives')
            ) {
              office.officialIndices.forEach(idx => {
                const official = officials[idx];
                repNames.push(`${office.name}: ${official.name}`);
                representatives.push({ office: office.name, name: official.name, email: official.emails ? official.emails[0] : '' });
              });
            }
          });

          if (repNames.length === 0) {
            repsList.textContent = 'No representatives found for this ZIP.';
          } else {
            repsList.innerHTML = '<b>Your Representatives:</b><br>' + repNames.join('<br>');
          }
        })
        .catch(err => {
          repsList.textContent = 'Error fetching representatives: ' + err.message;
        });
    });

    form.addEventListener('submit', function(event) {
      event.preventDefault();

      const fullName = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const city = document.getElementById('city').value;
      const state = document.getElementById('state').value;
      const zip = document.getElementById('zip').value;

      // Build representatives string
      let repsText = '';
      if (representatives.length > 0) {
        repsText = 'Your Representatives:\n';
        representatives.forEach(rep => {
          repsText += `${rep.office}: ${rep.name}\n`;
        });
        repsText += '\n';
      }

      const letter = `
Subject: Demand for Immediate Release of Archbishops Bagrat and Mikael

Dear Senator/Congressman,

My name is ${fullName}, a resident of ${city}, ${state}, and I write to urge you to speak out against the unlawful detention of Archbishops Bagrat Galstanyan and Mikael Adjapahyan in Armenia.

As a citizen who believes in religious freedom, justice, and democratic values, I am deeply concerned by the actions of the Armenian government in silencing spiritual leaders who have stood with the people.

${repsText}I urge you to raise your voice and call for their immediate release, and to use your office to advocate for the rule of law and freedom of expression in Armenia.

Sincerely,
${fullName}
${address}
${city}, ${state} ${zip}
${phone ? phone : ''}
${email}
      `.trim();

      letterPreview.textContent = letter;
      letterContainer.classList.remove('hidden');

      const mailtoLink = `mailto:?subject=Support for Detained Armenian Archbishops&body=${encodeURIComponent(letter)}`;
      sendEmailButton.setAttribute('onclick', `window.location.href='${mailtoLink}'`);
    });

    function copyLetter() {
      const text = letterPreview.textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('Letter copied to clipboard!');
      });
    }
  </script>

</body>
</html>
