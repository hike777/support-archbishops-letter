<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Support Archbishops Bagrat & Mikael</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h1 {
      color: #8B0000;
      text-align: center;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #8B0000;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    #letterPreview {
      background: #fff;
      padding: 20px;
      border-left: 4px solid #8B0000;
      white-space: pre-wrap;
    }
    .hidden {
      display: none;
    }
    #repsList {
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

  <h1>Support Archbishops Bagrat Galstanyan & Mikael Adjapahyan</h1>
  <p style="text-align:center; font-weight: bold;">
    Demand their immediate release from unlawful detention in Armenia.
  </p>

  <form id="letterForm">
    <input type="text" id="fullName" placeholder="Full Name" required />
    <input type="text" id="email" placeholder="Email Address" required />
    <input type="text" id="phone" placeholder="Phone Number (optional)" />
    <input type="text" id="address" placeholder="Street Address" required />
    <input type="text" id="city" placeholder="City" required />
    <input type="text" id="state" placeholder="State" required />
    <input type="text" id="zip" placeholder="ZIP Code" required />

    <select id="language">
      <option value="en">English</option>
      <option value="hy">Armenian</option>
      <option value="ru">Russian</option>
    </select>

    <button type="button" id="lookupReps">Lookup Representatives</button>
    <div id="repsList" class="hidden"></div>

    <button type="submit">Generate Letter</button>
  </form>

  <div id="letterContainer" class="hidden">
    <h2>Your Letter:</h2>
    <div id="letterPreview"></div>
    <button onclick="copyLetter()">📋 Copy Letter</button>
    <button id="sendEmailButton">📧 Send via Email</button>
  </div>

  <script>
    const lookupButton = document.getElementById('lookupReps');
    const repsList = document.getElementById('repsList');
    let representatives = [];

    lookupButton.addEventListener('click', () => {
      const zip = document.getElementById('zip').value.trim();
      if (!zip.match(/^\d{5}$/)) {
        alert('Please enter a valid 5-digit ZIP code');
        return;
      }

      repsList.innerHTML = 'Looking up representatives...';
      repsList.classList.remove('hidden');

      // Use JSONP workaround due to CORS limits
      const script = document.createElement('script');
      script.src = `https://whoismyrepresentative.com/getall_mems.php?zip=${zip}&output=json&callback=displayReps`;
      document.body.appendChild(script);
    });

    function displayReps(data) {
      representatives = data.results || [];
      if (representatives.length === 0) {
        repsList.textContent = 'No representatives found for this ZIP.';
        return;
      }

      repsList.innerHTML = '<b>Your Federal Representatives:</b><br>';
      representatives.forEach(rep => {
        const name = rep.name;
        const email = `${name.toLowerCase().replace(/ /g, '.')}@house.gov`;
        repsList.innerHTML += `
          <div style="margin-bottom:8px;">
            ${rep.office}: ${rep.name}
            <button onclick="window.open('mailto:${email}')">Send Email</button>
          </div>`;
      });
    }

    document.getElementById('letterForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const fullName = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const city = document.getElementById('city').value;
      const state = document.getElementById('state').value;
      const zip = document.getElementById('zip').value;
      const lang = document.getElementById('language').value;

      let letter = '';

      if (lang === 'hy') {
        letter = `
Վերնագիր․ Պահանջում եմ բաց թողնել արքեպիսկոպոս Բագրատին և Միքայելին

Հարգելի Սենատոր/Կոնգրեսական,

Ես՝ ${fullName}-ը, ապրում եմ ${city}, ${state}-ում։ Հայտնում եմ իմ մտահոգությունը Հայաստանում արքեպիսկոպոս Բագրատ Գալստանյանի և Միքայել Աջապահյանի ապօրինի կալանավորման կապակցությամբ։

Նրանք հոգևոր առաջնորդներ են, ովքեր կանգնած են ժողովրդի կողքին։ Կոչ եմ անում Ձեզ՝ դատապարտել այս գործողությունները և պահանջել նրանց անհապաղ ազատ արձակումը։

Հարգանքով՝
${fullName}
${address}
${city}, ${state} ${zip}
${email} ${phone}
        `.trim();
      } else if (lang === 'ru') {
        letter = `
Тема: Требуем немедленного освобождения архиепископов Баграта и Микаэла

Уважаемый Сенатор / Конгрессмен,

Меня зовут ${fullName}, я живу в ${city}, ${state}. Я выражаю глубокую обеспокоенность по поводу незаконного задержания архиепископов Баграта Галстаняна и Микаэла Аджапахяна в Армении.

Они — духовные лидеры, выступающие за справедливость. Призываю Вас публично осудить эти действия и потребовать их немедленного освобождения.

С уважением,
${fullName}
${address}
${city}, ${state} ${zip}
${email} ${phone}
        `.trim();
      } else {
        letter = `
Subject: Demand for Immediate Release of Archbishops Bagrat and Mikael

Dear Senator/Congressman,

My name is ${fullName}, a resident of ${city}, ${state}, and I urge you to speak out against the unlawful detention of Archbishops Bagrat Galstanyan and Mikael Adjapahyan in Armenia.

As someone who values democracy and religious freedom, I ask you to publicly demand their release and advocate for the rule of law in Armenia.

Sincerely,
${fullName}
${address}
${city}, ${state} ${zip}
${email} ${phone}
        `.trim();
      }

      document.getElementById('letterPreview').textContent = letter;
      document.getElementById('letterContainer').classList.remove('hidden');
      document.getElementById('sendEmailButton').onclick = () => {
        window.location.href = `mailto:?subject=Support for Detained Armenian Archbishops&body=${encodeURIComponent(letter)}`;
      };
    });

    function copyLetter() {
      const text = document.getElementById('letterPreview').textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('Letter copied to clipboard!');
      });
    }
  </script>

</body>
</html>
